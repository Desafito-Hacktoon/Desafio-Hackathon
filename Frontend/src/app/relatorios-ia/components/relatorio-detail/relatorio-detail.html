<div class="font-sans">
    @if (loading()) {
    <div class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
        <p class="mt-4 text-gray-600">Carregando relat√≥rio...</p>
    </div>
    }

    @if (error() && !loading()) {
    <z-card zTitle="Erro">
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="text-red-800 mb-4">{{ error() }}</p>
            <button z-button zType="default" zSize="default" (click)="voltar()"
                class="!bg-black !text-white hover:!bg-gray-800">
                Voltar
            </button>
        </div>
    </z-card>
    }

    @if (relatorio(); as rel) {
    <div class="mb-6 flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-semibold text-gray-900">{{ rel.titulo }}</h1>
            <div class="flex items-center gap-3 mt-2">
                <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full"
                    [class]="getStatusBadgeClass(rel.status)">
                    {{ rel.status }}
                </span>
                <span
                    class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 text-gray-700">
                    {{ getTipoRelatorioLabel(rel.tipoRelatorio) }}
                </span>
                @if (rel.modeloIAUsado) {
                <span
                    class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full bg-purple-100 text-purple-700">
                    {{ rel.modeloIAUsado }}
                </span>
                }
            </div>
        </div>
        <button z-button zType="default" zSize="default" (click)="voltar()" class="!bg-gray-100 hover:!bg-gray-200">
            ‚Üê Voltar
        </button>
    </div>

    <z-card zTitle="Informa√ß√µes do Relat√≥rio" class="mb-6">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
            <div>
                <p class="text-gray-500 mb-1">Per√≠odo In√≠cio</p>
                <p class="font-medium text-gray-900">{{ rel.periodoInicio | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>
            <div>
                <p class="text-gray-500 mb-1">Per√≠odo Fim</p>
                <p class="font-medium text-gray-900">{{ rel.periodoFim | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>
            <div>
                <p class="text-gray-500 mb-1">Data de Gera√ß√£o</p>
                <p class="font-medium text-gray-900">{{ rel.dataGeracao | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>
            @if (rel.tempoProcessamentoMs) {
            <div>
                <p class="text-gray-500 mb-1">Tempo de Processamento</p>
                <p class="font-medium text-gray-900">{{ (rel.tempoProcessamentoMs / 1000).toFixed(1) }}s</p>
            </div>
            }
        </div>
    </z-card>

    @if (rel.metricasCalculadas; as metricas) {
    <z-card zTitle="M√©tricas Calculadas" class="mb-6">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-gray-50 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-1">Total de Ocorr√™ncias</p>
                <p class="text-2xl font-semibold text-gray-900">{{ metricas.totalOcorrencias }}</p>
            </div>
            @if (metricas.gravidadeMedia) {
            <div class="bg-gray-50 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-1">Gravidade M√©dia</p>
                <p class="text-2xl font-semibold text-gray-900">
                    {{ metricas.gravidadeMedia.toFixed(1) }}
                </p>
            </div>
            }
            @if (metricas.variacaoPercentual !== undefined) {
            <div class="bg-gray-50 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-1">Varia√ß√£o</p>
                <p class="text-2xl font-semibold" [class.text-green-600]="metricas.variacaoPercentual >= 0"
                    [class.text-red-600]="metricas.variacaoPercentual < 0">
                    {{ metricas.variacaoPercentual >= 0 ? '+' : '' }}
                    {{ metricas.variacaoPercentual.toFixed(1) }}%
                </p>
            </div>
            }
            @if (metricas.topBairrosCriticos) {
            <div class="bg-gray-50 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-1">Bairros Cr√≠ticos</p>
                <p class="text-2xl font-semibold text-gray-900">
                    {{ metricas.topBairrosCriticos.length }}
                </p>
            </div>
            }
        </div>
    </z-card>
    }

    @if (rel.resumoExecutivo) {
    <z-card zTitle="Resumo Executivo" class="mb-6">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <p class="text-gray-700 leading-relaxed whitespace-pre-line">{{ rel.resumoExecutivo }}</p>
        </div>
    </z-card>
    }

    @if (rel.conteudoCompleto && rel.conteudoCompleto.principaisAchados; as principaisAchados) {
    @if (principaisAchados.length > 0) {
    <z-card zTitle="Principais Achados" class="mb-6">
        <ul class="space-y-2">
            @for (achado of principaisAchados; track $index) {
            <li class="flex items-start gap-2">
                <span class="text-blue-600 mt-1">‚Ä¢</span>
                <span class="text-gray-700">{{ achado }}</span>
            </li>
            }
        </ul>
    </z-card>
    }
    }

    @if (rel.areasCriticas; as areasCriticas) {
    @if (areasCriticas.length > 0) {
    <z-card zTitle="√Åreas Cr√≠ticas Identificadas" class="mb-6">
        <div class="grid gap-4">
            @for (area of areasCriticas; track area.bairro) {
            <div class="border border-red-200 rounded-lg p-4 bg-red-50">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-semibold text-gray-900">{{ area.bairro }}</h3>
                    <span class="text-sm text-gray-600">{{ area.totalOcorrencias }} ocorr√™ncias</span>
                </div>
                @if (area.tipoProblema) {
                <p class="text-sm text-gray-600 mb-2">
                    Tipo principal: {{ area.tipoProblema }}
                </p>
                }
                <p class="text-sm text-gray-700">
                    Gravidade m√©dia: <span class="font-semibold">{{ area.gravidadeMedia }}</span>
                </p>
                @if (area.razao) {
                <p class="mt-2 text-sm text-gray-700">
                    {{ area.razao }}
                </p>
                }
            </div>
            }
        </div>
    </z-card>
    }
    }

    @if (rel.conteudoCompleto && rel.conteudoCompleto.tendencias; as tendencias) {
    <z-card zTitle="Tend√™ncias" class="mb-6">
        <div class="space-y-3">
            @if (tendencias.crescimento) {
            <div>
                <h3 class="font-medium text-gray-900 mb-1">Crescimento</h3>
                <p class="text-gray-700">{{ tendencias.crescimento }}</p>
            </div>
            }
            @if (tendencias.padroesTemporais) {
            <div>
                <h3 class="font-medium text-gray-900 mb-1">Padr√µes Temporais</h3>
                <p class="text-gray-700">{{ tendencias.padroesTemporais }}</p>
            </div>
            }
            @if (tendencias.correlacoes) {
            <div>
                <h3 class="font-medium text-gray-900 mb-1">Correla√ß√µes</h3>
                <p class="text-gray-700">{{ tendencias.correlacoes }}</p>
            </div>
            }
        </div>
    </z-card>
    }

    @if (rel.recomendacoes; as recomendacoes) {
    @if (recomendacoes.length > 0) {
    <z-card zTitle="Recomenda√ß√µes" class="mb-6">
        <div class="space-y-4">
            @for (rec of recomendacoes; track rec.acao) {
            <div class="border-l-4 border-blue-500 pl-4 py-2">
                <div class="flex items-center gap-2 mb-2">
                    <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full"
                        [class]="getPrioridadeBadgeClass(rec.prioridade)">
                        {{ rec.prioridade.toUpperCase() }}
                    </span>
                </div>
                <h3 class="font-semibold text-gray-900 mb-1">{{ rec.acao }}</h3>
                <p class="text-sm text-gray-600 mb-2">{{ rec.justificativa }}</p>
                <p class="text-sm text-gray-700">
                    <span class="font-medium">Impacto esperado:</span> {{ rec.impactoEsperado }}
                </p>
            </div>
            }
        </div>
    </z-card>
    }
    }

    @if (rel.conteudoCompleto && rel.conteudoCompleto.insights) {
    @if (rel.conteudoCompleto.insights.length > 0) {
    <z-card zTitle="Insights Adicionais" class="mb-6">
        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
            <ul class="space-y-2">
                @for (insight of rel.conteudoCompleto.insights; track $index) {
                <li class="flex items-start gap-2">
                    <span class="text-purple-600 mt-1">üí°</span>
                    <span class="text-gray-700">{{ insight }}</span>
                </li>
                }
            </ul>
        </div>
    </z-card>
    }
    }
    }
</div>